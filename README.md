# WSI Viewing Assistant (Name Pending)
### Team TBD - Josh White, Jared Zins, Tim Deutsch, Deepak Warrier

## What is this?
This project's goal is to assist pathologists in viewing Whole Slide Images (WSIs) for diagnosing cancer. These images are quite large in resolution ($24470 \times 19133$ as compared to modern 4K images at $3840 \times 2160$), which means that pathologists have a lot to look through when trying to find hotspots for cancer in the WSI.

Our project helps by helping the pathologists keep track of where they looked by using a VR headset to track the their gaze and visualize their look patterns as a heatmap on the WSI. We also offer controls to swap out the WSI as well as manipulate the image around the user.

## Just Run This...
Here are some steps to quickly run and deploy this project:
1. Make sure all the [dependencies](#dependencies) are installed/setup
   1. This includes Getting a
2. Open the project in Unity
   1. Either by using Unity Hub to import the project or via Unity itself through its `File > Open...` dialog.
3. When the project is finished loading, build the app using Android Build settings and run it on the connected headset using Unity's `Build and Run` option.
   1. Make sure the `Oculus_Proto` scene is selected for build.
4. Open the app in the Quest Headset and feel free to play around
   1. Using the left hand "Grip Button" (see the below image for reference), you can open a menu above the controller to turn on/off the Heatmap and change the current slide being viewed.
   2. By gazing at the WSI and by having the Heatmap toggled on, you will see hotspots being generated as you spend time looking at one spot.
   3. By pointing the blue ray from your right hand at the slide and moving the right thumbstick left/right/up/down, you can move the image around you. This image is fixed in a circle around you.

![Quest Controller Layout](https://www.gamearter.com/img/blog/posts/xr-input-manager-controllers/oculus-vr-controllers.png)

## Dependencies/Requirements
We make use of a few different technologies in this project.

1. Unity v2020.3.32f1 - A Game Development Framework
   1. While later versions of Unity *should* work, we have only tested on this version
   2. You can download this from either the Unity Archive (https://unity3d.com/get-unity/download/archive), or from Unity Hub (https://unity3d.com/get-unity/download)
2. OpenSlideNET - A .NET binding for the OpenSlide library for interacting with WSIs
   1. We have included the relevant DLLs and plugins as part of this project (see [Layout](#layout) for more details).
   2. For more information about the .NET library, see https://github.com/yigolden/OpenSlideNET.
   3. For more information about OpenSlide in general, see https://openslide.org/ 
3. Oculus Integration SDK - A SDK for developing VR-centric games for Oculus Headsets
   1. We have included the Unity Plugin for the SDK as part of this project, so there's no need to re-download it (see [Layout](#layout) for more details)
   2. If you really want to though, go here for Oculus's instructions: https://developer.oculus.com/documentation/unity/unity-import/
4. SimpleFileBrowser - A simple file browser to show within the Unity Game
   1. We have included the Unity Asset version of this repo in this project. (see [Layout](#layout) for more details)
   2. To learn more about this asset, see https://github.com/yasirkula/UnitySimpleFileBrowser

We also require that you use a **Oculus Quest**-based headset. ***We have only tested on Quest 1 and 2***, so have fun at your own expense when trying on other headsets.

## Layout
Here is the directory layout of the relevant files for the project. All files/folders that are not listed here are generated by Unity and should not be tampered with.
```
Folder PATH listing for volume Windows-SSD
Volume serial number is 04CD-EFAF
C:
├───Assets
│   ├───Materials
│   │   ├───HotSpot
│   │   └───*another folder here*
│   ├───NuGet
│   │   ├───Editor
│   │   └───Resources
│   ├───Oculus
│   │   ├───*more files here*
│   ├───Packages
│   │   ├───OpenSlideNET.1.0.0
│   │   │   └───lib
│   │   │       └───net46
│   │   ├───OpenSlideNET.Interop.1.0.0
│   │   │   └───lib
│   │   │       └───net46
│   │   ├───System.Buffers.4.5.1
│   │   │   └───lib
│   │   │       └───net461
│   │   ├───System.Memory.4.5.4
│   │   │   └───lib
│   │   │       └───net461
│   │   └───System.Runtime.CompilerServices.Unsafe.4.5.3
│   │       └───lib
│   │           └───net461
│   ├───Plugins
│   │   └───SimpleFileBrowser
│   │       ├───Android
│   │       ├───Prefabs
│   │       ├───Resources
│   │       ├───Scripts
│   │       │   └───SimpleRecycledListView
│   │       ├───Skins
│   │       └───Sprites
│   │           └───FileIcons
│   ├───Scenes
│   ├───Scripts
│   │   ├───CurlyUI
│   │   ├───HandGUI
│   │   ├───HotspotTest
│   │   ├───Interactions
│   │   └───WSIDemo
│   ├───Shaders
│   ├───TIff Test
```

The major entrypoints for modifying this project are outlined below:
- `Materials/HotSpot` - Contains the `.mat` files for rendering the WSI files in Unity. In order for materials to work, the relevant files in `Tiff Test` need to be available, otherwise, you will need to supply your own WSI files in `.tif` format.
- `NuGet` - You don't want to touch this one. It helps OpenSlideNET run within Unity, and is based on the NuGet package for Unity
- `Oculus` - Don't touch this one either. This folder contains all the resources for using the Oculus SDK within Unity. You will see references to the resources of this folder within the scene.
- `Packages` - This one too... It contains the actual `dll`s for OpenSlideNET.
- `Plugins` - This folder contains an asset we borrowed from <> that creates a simple file browser in the VR space. You shouldn't have to touch this one either.
- `Scenes` - This folder contains a set of scenes that we used during the development of this project. There are a few different scenes in here, but focus on the `Oculus_Proto` scene for the most up-to-date experience.
-  `Scripts` - This folder contains the scripts that drive most of the behavior in the game. They are somewhat organized into their general functions:
   -  `CurlyUI` - Holds the scripts for generating constrained, curved planes.
   -  `HandGUI` - Holds the scripts for rendering the hand-anchored menu
   -  `HotSpotTest` - Holds the scripts for rendering and storing information about the WSI's Heatmap
   -  `Interactions` - Holds the scripts for enabling user-driven motion of the viewing plane.
   -  `WSIDemo` - These scripts are mostly ***defunct*** and are not referenced in the `Oculus_Proto` scene. The script in here was mainly for us to test the usability of OpenSlideNET within Unity.
-  `Shaders` - The shaders for the WSI Heatmap
-  `Tiff Test` - Contains the `.tif` files that are used by the materials in `Materials/HotSpot` to render the file in Unity.